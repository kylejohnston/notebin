<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="currentColor-translucent">
    <meta name="apple-mobile-web-app-title" content="notebin">
    <meta name="theme-color" content="#ffffff">
    <title>notebin</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-180.png">
    <link rel="stylesheet" href="style.css">
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/localforage@1.10.0/dist/localforage.min.js"></script>
</head>
<body x-data="noteApp()" x-init="init()" :class="colorMode">
    <!-- Menu button -->
    <button
        @click="toggleMenu()"
        class="menu-trigger"
        aria-label="Open menu"
    >
        <svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9.414 22.662C6.012 22.662 4.5 20.478 4.5 15.081C4.5 9.684 6.012 7.5 9.414 7.5C12.816 7.5 14.328 9.684 14.328 15.081C14.328 20.478 12.816 22.662 9.414 22.662ZM9.414 20.415C11.01 20.415 11.556 19.449 11.556 17.139V13.023C11.556 10.713 11.01 9.747 9.414 9.747C7.818 9.747 7.272 10.713 7.272 13.023V17.139C7.272 19.449 7.818 20.415 9.414 20.415Z" fill="currentColor"/>
            <path d="M20.7548 22.662C17.3528 22.662 15.8408 20.478 15.8408 15.081C15.8408 9.684 17.3528 7.5 20.7548 7.5C24.1568 7.5 25.6688 9.684 25.6688 15.081C25.6688 20.478 24.1568 22.662 20.7548 22.662ZM20.7548 20.415C22.3508 20.415 22.8968 19.449 22.8968 17.139V13.023C22.8968 10.713 22.3508 9.747 20.7548 9.747C19.1588 9.747 18.6128 10.713 18.6128 13.023V17.139C18.6128 19.449 19.1588 20.415 20.7548 20.415Z" fill="currentColor"/>
        </svg>
    </button>

    <!-- Note area -->
    <div
        x-ref="noteArea"
        contenteditable="true"
        @input="handleInput($event)"
        @blur="saveNote()"
        @paste="handlePaste($event)"
        :style="`font-size: ${textSize}px;`"
        class="note-area"
        role="textbox"
        aria-label="Note content"
        aria-multiline="true"
        spellcheck="true"
        autocorrect="on"
    ></div>

    <!-- Menu overlay -->
    <div
        x-show="menuOpen"
        @click="closeMenu()"
        class="scrim"
        x-transition.opacity
    ></div>

    <!-- Menu panel -->
    <div
        x-show="menuOpen"
        class="menu-panel"
        x-transition:enter="menu-enter"
        x-transition:enter-start="menu-enter-start"
        x-transition:enter-end="menu-enter-end"
        x-transition:leave="menu-leave"
        x-transition:leave-start="menu-leave-start"
        x-transition:leave-end="menu-leave-end"
        @click.outside="closeMenu()"
    >
        <!-- Text size -->
        <div class="menu-item">
            <span class="menu-label">Text size<span class="text-size-value" x-text="` Â· ${textSize}px`"></span></span>
            <div class="menu-controls">
                <button @click="decreaseTextSize()" class="control-btn" aria-label="Decrease text size">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 10H17" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
                <button @click="increaseTextSize()" class="control-btn" aria-label="Increase text size">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 10H17M10 3V17" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Color mode -->
        <div class="menu-item">
            <span class="menu-label">Color mode</span>
            <button
                @click="toggleColorMode()"
                class="toggle-btn"
                :class="{ 'active': colorModeOverride !== null }"
                aria-label="Toggle color mode"
            >
                <span class="toggle-track">
                    <span class="toggle-thumb"></span>
                </span>
            </button>
        </div>

        <!-- Clear note -->
        <div class="menu-item">
            <span class="menu-label">Clear note</span>
            <button
                @click="handleClear()"
                class="clear-btn"
                :class="{ 'confirm-state': clearConfirmPending }"
                aria-label="Clear note"
            >
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M5 5L15 15M15 5L5 15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
            </button>
        </div>
    </div>

    <!-- Floating action buttons -->
    <div
        class="floating-actions"
        x-show="undoButtonVisible || pasteButtonVisible"
        x-transition.opacity.duration.2000ms
    >
        <button
            x-show="undoButtonVisible"
            @click="handleUndo()"
            class="action-btn"
            aria-label="Undo"
        >
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g clip-path="url(#clip0_5651_204)">
                    <path d="M6.75 10.625L3 6.875M3 6.875L6.75 3.125M3 6.875H12.625C13.7853 6.875 14.8981 7.33594 15.7186 8.15641C16.5391 8.97688 17 10.0897 17 11.25C17 12.4103 16.5391 13.5231 15.7186 14.3436C14.8981 15.1641 13.7853 15.625 12.625 15.625H6.75" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </g>
                <defs>
                    <clipPath id="clip0_5651_204">
                        <rect width="20" height="20" fill="white"/>
                    </clipPath>
                </defs>
            </svg>
        </button>
        <button
            x-show="pasteButtonVisible"
            @click="handlePasteButton()"
            class="action-btn"
            aria-label="Paste"
        >
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect x="4" y="4" width="12" height="13" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                <circle cx="10" cy="4" r="3" fill="currentColor"/>
            </svg>
        </button>
    </div>

    <script src="app.js"></script>
    <script>
        // Register service worker (DISABLED FOR DEVELOPMENT)
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/notebin/sw.js')
                .then((registration) => {
                    console.log('Service Worker registered:', registration);
                })
                .catch((error) => {
                    console.log('Service Worker registration failed:', error);
                });
        }
    </script>
</body>
</html>
